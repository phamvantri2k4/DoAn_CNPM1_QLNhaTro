<div class="page-shell">
  <section class="hero">
    <div class="hero-text">
      <h1 class="hero-title">Danh s√°ch b√†i ƒëƒÉng</h1>
      <p class="hero-sub" *ngIf="!error">
        T√¨m th·∫•y <strong>{{ filteredListings.length }}</strong> b√†i ƒëƒÉng
      </p>
    </div>

    <div class="hero-search">
      <div class="search-box">
        <span class="search-icon">üîç</span>
        <input type="text" [(ngModel)]="searchTerm" placeholder="T√¨m theo ƒë·ªãa ƒëi·ªÉm, t√™n ph√≤ng..." />
        <button type="button" class="btn ghost" (click)="toggleFilters()">B·ªô l·ªçc</button>
        <button type="button" class="btn primary" (click)="fetch()">T·∫£i l·∫°i</button>
      </div>

      <div class="filter-panel" *ngIf="showFilters">
        <div class="filter-row">
          <div class="filter-left">
            <div class="location-filters">
              <div class="loc-field">
                <div class="loc-label">T·ªânh th√†nh</div>
                <select class="select" [(ngModel)]="selectedProvince" (ngModelChange)="onProvinceChange()">
                  <option value="">To√†n qu·ªëc</option>
                  <option *ngFor="let p of provinceOptions" [value]="p">{{ p }}</option>
                </select>
              </div>

              <div class="loc-field">
                <div class="loc-label">Qu·∫≠n huy·ªán</div>
                <select class="select" [(ngModel)]="selectedDistrict" (ngModelChange)="onDistrictChange()" [disabled]="!selectedProvince">
                  <option value="">T·∫•t c·∫£</option>
                  <option *ngFor="let d of districtOptions" [value]="d">{{ d }}</option>
                </select>
              </div>

              <div class="loc-field">
                <div class="loc-label">Ph∆∞·ªùng x√£</div>
                <select class="select" [(ngModel)]="selectedWard" [disabled]="!selectedDistrict">
                  <option value="">T·∫•t c·∫£</option>
                  <option *ngFor="let w of wardOptions" [value]="w">{{ w }}</option>
                </select>
              </div>
            </div>

            <div class="range-section">
              <div class="range-title">Kho·∫£ng gi√°</div>
              <div class="chips">
                <button
                  type="button"
                  class="chip"
                  *ngFor="let r of priceRanges"
                  [class.active]="selectedPriceRange === r.key"
                  (click)="selectPriceRange(r.key)"
                >
                  {{ r.label }}
                </button>
              </div>
            </div>

            <div class="range-section">
              <div class="range-title">Kho·∫£ng di·ªán t√≠ch</div>
              <div class="chips">
                <button
                  type="button"
                  class="chip"
                  *ngFor="let r of areaRanges"
                  [class.active]="selectedAreaRange === r.key"
                  (click)="selectAreaRange(r.key)"
                >
                  {{ r.label }}
                </button>
              </div>
            </div>

            <button type="button" class="btn ghost" (click)="clearFilters()">X√≥a l·ªçc</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <div *ngIf="error" class="error">{{ error }}</div>

  <section class="results" *ngIf="filteredListings.length; else emptyState">
    <div class="grid">
      <article class="room-card" *ngFor="let p of filteredListings">
        <div class="thumb">
          <img *ngIf="getFirstImage(p); else noImage" [src]="getFirstImage(p)!" alt="·∫¢nh ph√≤ng" loading="lazy" decoding="async" />
          <ng-template #noImage>
            <div class="thumb-placeholder">Kh√¥ng c√≥ ·∫£nh</div>
          </ng-template>

          <div class="badge-new" *ngIf="p.isNew">M·ªõi</div>
          <button type="button" class="fav-btn" title="Y√™u th√≠ch">‚ô•</button>
          <div class="price-chip" *ngIf="p.price">
            {{ p.price | number:'1.0-0' }}‚Ç´/th√°ng
          </div>
        </div>

        <div class="room-body">
          <h3 class="room-title">{{ p.title }}</h3>
          <p class="room-address" *ngIf="p.address">{{ p.address }}</p>
          <p class="room-desc">{{ p.description || 'Ch∆∞a c√≥ m√¥ t·∫£ chi ti·∫øt.' }}</p>

          <div class="room-meta">
            <span class="meta-item" *ngIf="p.area">{{ p.area }}m¬≤</span>
            <span class="meta-item" *ngIf="p.createdAt">{{ p.createdAt | date:'dd/MM/yyyy' }}</span>
          </div>

          <div class="room-footer">
            <div class="rating" *ngIf="p.rating">
              ‚òÖ {{ p.rating | number:'1.1-1' }}
              <span class="rating-count" *ngIf="p.ratingCount">({{ p.ratingCount }})</span>
            </div>
            <a [routerLink]="['/listings', p.id]" class="btn link">Xem chi ti·∫øt</a>
          </div>
        </div>
      </article>
    </div>
  </section>

  <ng-template #emptyState>
    <div class="empty" *ngIf="!error">
      <div class="empty-title">Kh√¥ng c√≥ b√†i ƒëƒÉng.</div>
    </div>
  </ng-template>
</div>